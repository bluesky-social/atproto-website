export const header = {
  title: 'Build an Agent',
  description: 'Create a bot that automatically posts on Bluesky',
}

Bots s√£o contas na rede que publicam automaticamente. Entre os mais populares est√£o os bots que publicam a magnitude de terremotos recentes, fotos de um arquivo em hor√°rios regulares, etc.
Neste tutorial, voc√™ criar√° um bot que se autentica com uma [senha de aplicativo](/guides/sdk-auth) para interagir com a rede.
## Pr√©-requisitos
Este tutorial envolve a cria√ß√£o de um aplicativo TypeScript do zero. Voc√™ deve ter um conhecimento pr√°tico de TypeScript e Node.js.
Voc√™ deve ter instalado:
- Node.js 18+
Em plataformas compat√≠veis com [homebrew](https://brew.sh/), voc√™ pode instal√°-lo com:
```bash
brew install node
```
Voc√™ tamb√©m deve ter nossa ferramenta CLI `lex` instalada globalmente:
```bash
npm install -g @atproto/lex
```
Agora, crie um novo diret√≥rio de projeto Typescript e inicialize seu projeto:
```bash
mkdir my-agent
cd my-agent
npm init -y
npm i -D typescript ts-node @types/node dotenv cron @atproto/lex @atproto/lex-password-session
npx tsc --init --verbatimModuleSyntax false
```
Se voc√™ n√£o estiver usando uma conta existente para postar, deve [criar uma nova conta](https://bsky.app/) para o seu bot. Voc√™ tamb√©m deve gerar uma [senha de aplicativo](/guides/sdk-auth) para essa conta.
## Parte 1: L√©xicos
[L√©xicos](/guides/lexicon) definem os registros do Atproto. Seu bot criar√° postagens no Bluesky usando o l√©xico [app.bsky.feed.post](https://pdsls.dev/at://did:plc:ewvi7nxzyoun6zhxrhs64oiz/app.bsky.feed.post/3juc4thkx452i#schema). Voc√™ pode usar `lex` para baixar e construir este l√©xico em seu projeto:
```bash
lex install app.bsky.feed.post
```
Se desejar, voc√™ pode visualizar o arquivo l√©xico baixado em `lib/lexicons/app.bsky.post.json`. A partir daqui, voc√™ pode executar `lex build` para gerar tipos TypeScript para todos os seus l√©xicos instalados:
```bash
lex build
```
O c√≥digo gerado ficar√° em `src/lexicons`. Agora voc√™ pode criar seu script de bot.
## Parte 2: Criar um bot
Crie um novo arquivo em `src/index.ts`. Esse arquivo conter√° o c√≥digo do seu bot.
Primeiro, adicione as importa√ß√µes necess√°rias e uma chamada para `PasswordSession.create()` para autenticar seu bot usando uma senha de aplicativo:
```ts
import { Client } from '@atproto/lex'
import { PasswordSession } from '@atproto/lex-password-session'
import * as dotenv from 'dotenv'
import { CronJob } from 'cron'
import * as process from 'process'
import * as app from './lexicons/app.js'
dotenv.config()
// Criar uma sess√£o
async function login() {
    const service = process.env.BOT_PDS!
    const identifier = process.env.BOT_HANDLE!
    const password = process.env.BOT_PASSWORD!
    
const sess√£o = await PasswordSession.login({
        servi√ßo, // por exemplo, 'https://bsky.social'
        identificador, // por exemplo, 'alice.bsky.social'
        senha,
    })
    retornar sess√£o
}
```
Em seguida, adicione uma fun√ß√£o que publique. Isso instanciar√° um novo `Cliente` usando a sess√£o autenticada e o utilizar√° para criar uma publica√ß√£o. O l√©xico `app.bsky.feed.post` requer dois par√¢metros: o texto de uma postagem ‚Äî voc√™ usar√° ‚ÄúüôÇ‚Äù ‚Äî e um carimbo de data/hora.
```ts
// L√≥gica de postagem
async function makePost(session: PasswordSession) {
    const client = new Client(session)
    
await client.create(app.bsky.feed.post, {
        text: 'üôÇ',
        createdAt: new Date().toISOString(),
    })
    console.log('Acabou de postar!')
}
async function main() {
    const session = await login()
    await makePost(session)
}
main().catch(console.error)
```
Por fim, adicione outro bloco de c√≥digo dentro de `main()` usando o pacote `cron` para programar seu bot para postar a cada tr√™s horas:
```ts
fun√ß√£o ass√≠ncrona main() {
    const session = await login()
    await makePost(session)
    // Execute isso em uma tarefa cron
    const scheduleExpression = '0 */3 * * *'
    
const job = new CronJob(scheduleExpression, () => makePost(session))
 
    job.start()
}
```
Esse √© todo o c√≥digo necess√°rio para o seu bot! A seguir, voc√™ ir√° test√°-lo.
## Parte 3: Execute o bot
Salve o host (PDS), nome de usu√°rio e senha do seu bot em um arquivo `.env`.
```bash
BOT_PDS= # por exemplo, 'https://bsky.social' se voc√™ n√£o estiver hospedando seu pr√≥prio PDS
BOT_HANDLE= # por exemplo, 'alice.bsky.social'
BOT_PASSWORD=
```
Agora voc√™ pode testar o bot usando `ts-node`.
```bash
ts-node src/index.ts
```
Voc√™ pode executar este bot em sua pr√≥pria m√°quina ou implant√°-lo em uma plataforma como [Fly.io](http://fly.io/).
Lembre-se de que os bots devem respeitar os limites de taxa da rede. Por exemplo, [o Bluesky tem seu pr√≥prio conjunto de limites de taxa](https://docs.bsky.app/docs/advanced-guides/rate-limits).
 
## Parte 4: De bot a agente
At√© agora, voc√™ criou um bot que faz postagens em intervalos regulares. Agora, voc√™ pode expandir seu bot para um agente mais complexo que interage com outros usu√°rios!
Nesta se√ß√£o, voc√™ usar√° o [Vercel AI SDK](https://www.npmjs.com/package/ai). Essa biblioteca fornece uma API unificada para interagir com provedores de modelos como o Anthropic por meio do Vercel AI Gateway. Voc√™ precisar√° se inscrever em um [projeto Hobby](https://vercel.com/) gratuito para obter uma chave API.
Depois de obter uma chave API, adicione o AI SDK ao seu projeto:
```bash
npm i ai
```
Em seguida, adicione outra vari√°vel de ambiente ao seu arquivo `.env`:
```bash
BOT_PDS=
BOT_HANDLE=
BOT_PASSWORD=
AI_GATEWAY_API_KEY=xxxxxxxxx
```
Por fim, voc√™ precisar√° instalar alguns l√©xicos adicionais para obter men√ß√µes. Execute o seguinte comando para instalar e construir os l√©xicos necess√°rios:
```bash
lex install app.bsky.notification.listNotifications app.bsky.feed.getPostThread
lex build --override
```
Est√° quase pronto. Adicione a importa√ß√£o `ai` ao seu arquivo `src/index.ts`:
```ts
import { generateText } from 'ai'
```
Agora voc√™ pode substituir tudo ap√≥s a fun√ß√£o `login` no seu script por uma nova l√≥gica que usa o SDK de IA para gerar respostas:
```ts
async function generateReply(mentionText: string): Promise<string> {
  const { text } = await generateText({
    model: 'anthropic/claude-sonnet-4-5',
    system: 'Voc√™ √© um bot m√≠stico que l√™ a sorte no Bluesky chamado ‚ÄúThe Oracle‚Äù. Fale em um tom dram√°tico e misterioso, usando emojis ocasionais (üîÆ ‚ú® üåô ‚≠ê). Se algu√©m fizer uma pergunta que possa ser respondida com sim ou n√£o, d√™ uma resposta enigm√°tica, mas sugestiva. Se pedirem orienta√ß√µes gerais, ofere√ßa uma breve previs√£o no estilo hor√≥scopo. Mantenha as respostas com menos de 280 caracteres. Nunca saia do personagem.',
 
    prompt: mentionText,
  })
  return text
}
// Verifique se h√° novas men√ß√µes e responda
fun√ß√£o ass√≠ncrona checkMentions(sess√£o: PasswordSession) {
const cliente = novo Cliente(sess√£o)
const notifica√ß√µes = aguardar cliente.call(app.bsky.notification.listNotifications, {
limite: 20,
})
para (const notif de notifica√ß√µes.notifica√ß√µes) {
// Processe apenas men√ß√µes n√£o lidas
    
if (notif.reason !== 'mention' || notif.isRead) continue
    // Obter a publica√ß√£o que nos mencionou
const post = await client.call(app.bsky.feed.getPostThread, {
      uri: notif.uri,
    })
    const mentionText = post.thread.post.record.text
    
const reply = await generateReply(mentionText)
    // Responder √† publica√ß√£o
    await client.create(app.bsky.feed.post, {
      text: reply,
      createdAt: new Date().toISOString(),
      reply: {
        root: { uri: notif.uri, cid: post.thread.post.cid },
        
parent: { uri: notif.uri, cid: post.thread.post.cid },
      },
    })
    console.log(`Respondido √† men√ß√£o: ${mentionText}`)
  
}
}
fun√ß√£o ass√≠ncrona principal() {
const sess√£o = aguardar login()
const tarefa = nova CronJob('*/1 * * * *', () => verificarMen√ß√µes(sess√£o))
tarefa.iniciar()
console.log('Agente em execu√ß√£o...')
}
principal().capturar(console.error)
```
Existem alguns conceitos novos aqui. Voc√™ reconhecer√° a l√≥gica `app.bsky.feed.post` e agora tamb√©m implementar√° `app.bsky.notification.listNotifications` e `app.bsky.feed.getPostThread`. O primeiro Lexicon √© usado para obter uma lista de notifica√ß√µes e o segundo busca o t√≥pico completo para um determinado URI de postagem.
...e fique √† vontade para alterar nosso exemplo bobo de prompt.
Reimplante seu bot e ele agora responder√° √†s men√ß√µes!
<Note>
Bots automatizados que postam em uma conta em intervalos regulares s√£o bem-vindos na rede. Se o seu bot interage com outros usu√°rios, interaja (curta, republique, responda etc.) apenas se o usu√°rio tiver marcado a conta do bot. Deve ser uma intera√ß√£o opcional, ou seu bot poder√° ser sinalizado como spam.
</Note>
## Conclus√£o
Voc√™ criou um aplicativo Atproto automatizado que cria registros na rede!
Voc√™ pode encontrar mais guias e tutoriais em nossa se√ß√£o [Guias](/guides) e mais exemplos de aplicativos no reposit√≥rio [Cookbook](https://github.com/bluesky-social/cookbook/). Boa constru√ß√£o!