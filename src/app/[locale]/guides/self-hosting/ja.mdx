import {Heading} from '@/components/Heading'

export const header = {
  title: 'セルフホスティング',
  description:
    'Atmosphereスタックの各コンポーネントをセルフホストするためのリソース',
}

Atmosphereスタックのほとんどの部分はデプロイメントがサポートされています。アプリケーションレベルのインフラ（AppViewやリレーといったもの）を提供するか、データレベルのインフラ（PDSやそれに推するもの）を提供するかによって、セルフホストの難易度は異なります。

<Heading level={2} id="pds">PDS</Heading>

インストール手順、Dockerイメージ、FAQを含むPDSのセルフホスティング用リソースは、[PDS](https://github.com/bluesky-social/pds)のGitHubリポジトリで入手できます。自分のPDSをホストしたい場合はここから始めてください。

PDSのDockerイメージには、管理機能を実行するためのコマンドラインツール[goat](https://github.com/bluesky-social/goat)が含まれています。

アカウントをあるPDS（例：BlueskyがホストするPDS）から別のPDSに移行する場合は、[アカウント移行](/guides/account-migration)を参照してください。

セルフホストしたPDSの*ドメイン名*を変更する必要がある場合は、次の操作を行ってください。

- ホストしている*各*アカウントのPLCエントリを変更してください。[boat](https://boat.kelinci.net/plc-applicator)のようなコミュニティ製のインターフェースを利用できます。
- 他のサーバーでやるようにDNS設定を更新し、その後`pds.env`内のドメイン名を変更してください。

PDSのスケーリングやセキュリティ強化に関する指針については、[本番環境への移行](/guides/going-to-production)を参照してください。

Blueskyは多くのPDSの前に「entryway」を置いて運用しています。この実装に関する情報は[entryway](https://docs.bsky.app/docs/advanced-guides/entryway)を参照してください。

コミュニティによるPDS実装もあります。例えば、以下があります。
- [Tranquil PDS](https://tangled.org/tranquil.farm/tranquil-pds)（Rust）
- [Cocoon](https://tangled.org/hailey.at/cocoon)（Go）

<Heading level={2} id="relays">リレー</Heading>

独自のリレーをホストすることは可能ですが、帯域幅を大量に消費します。リレーは通常、ATプロトコルネットワーク上のすべてのPDSやリポジトリからデータを複製する[フルネットワークモード](/guides/the-at-stack#relays)で動作します。ただし、[Sync 1.1](/blog/relay-updates-sync-v1-1)以降のリレーはネットワークデータのアーカイブを保持する必要がないため、ストレージを大量に消費することは*ありません*。

いくつかの異なるリレー実装があります。
- [リファレンス実装](https://github.com/bluesky-social/indigo/blob/main/cmd/relay/README.md)（Go）
- [Blacksky Relay](https://github.com/blacksky-algorithms/rsky/tree/main/rsky-relay#rsky-relay)（Rust）

<Heading level={2} id="tap">Tap</Heading>

TapはATネットワークから既存のレコードを同期し、その後firehoseから新しいレコードを継続的に受信するために使用されます。Tapのデプロイ方法については[Tapのreadme](https://github.com/bluesky-social/indigo/blob/main/cmd/tap/README.md#distribution--deployment)を参照してください。

また、[Railway](https://railway.com/)向けの[Tapデプロイのクイックスタートガイド](https://github.com/bluesky-social/indigo/blob/main/cmd/tap/RAILWAY_DEPLOY.md)も提供しています。

<Heading level={2} id="app-views">AppView</Heading>

独自のAppViewを作成・ホスティングすることは可能ですが、リソースを大量に消費します。自身のデータリポジトリへのアクセスを個人的に制御する手段であるPDSのホスティングと比較すると、AppViewのホスティングはアプリケーションレベルのインフラを提供するために行うものです。通常は必要なLexiconに関するネットワーク上の全データを複製することが最初の作業になります。始めるには[同期](/guides/sync)のドキュメントや、後述のTapセクションを参照してください。

Atmosphereアプリを設計・運用する際には他にも多くの判断事項があります。このガイドは推奨事項の包括的なリストではありません。

- アプリのサインアップフローでは、ユーザーがログインまたはアカウント作成を行う必要があります。Atmosphereを初めて利用するユーザー（まだPDSの概念を知らない可能性がある）に対してアプリ内で直接サインアップさせるため、アプリと一緒にPDSもホストすることを一般的に推奨します。PDSとAppViewは[異なるドメイン名](/guides/going-to-production#domain-names)を使用してください。

<Heading level={2} id="ozone">Ozone</Heading>

[Ozoneの使用](/guides/using-ozone)を参照してください。

<Heading level={2} id="deploy-recipes">デプロイレシピ</Heading>

公式ツールを使用しない、または異なる環境をサポートするコミュニティ提供のデプロイソリューションについては、[deploy-recipes](https://github.com/bluesky-social/deploy-recipes)のGitHubリポジトリを参照してください。貢献は歓迎します！
