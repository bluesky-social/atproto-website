export const metadata = {
  title: '계정',
  description: '계정 호스팅 및 수명 주기',
}

# 계정 호스팅

atproto 네트워크의 모든 사용자는 고유하고 불변의 DID를 기반으로 하는 "정체성"을 가지고 있습니다. 활성 사용자들은 Personal Data Server (PDS)에 "계정"을 가지고 있으며, PDS는 레포지토리 호스팅, 권한 부여 및 인증, 블롭 저장 등 여러 네트워크 서비스를 제공합니다. 계정은 수명 주기를 가지며(삭제 및 중단 등을 포함), 정체성은 호스팅 제공자 간에 이전될 수 있습니다. 릴레이 및 AppViews 등 하위 서비스는 계정 콘텐츠를 재배포할 수 있습니다.

각 콘텐츠를 재배포하는 서비스는 계정과 콘텐츠를 호스팅 및 재배포할 때 개별적으로 결정해야 합니다. 예를 들어, 네트워크의 일부 계정에 집중하거나, 자체 콘텐츠 정책을 정의하거나, 지역별 법적 의무를 가질 수 있습니다. 모든 서비스는 아래에 설명된 임시 계정 비활성화와 같은 프로토콜 수준의 계정 동작을 준수해야 합니다. 이와 같이, 각 네트워크 서비스는 공개 데이터를 재배포하는 각 계정에 대해 종합적인 “호스팅 상태”를 갖게 됩니다.

이 문서는 네트워크 내에서 계정과 정체성이 가질 수 있는 다양한 호스팅 상태, 상태 변화 시 하위 서비스의 기대 사항, 그리고 계정을 다른 호스팅 제공자(PDS 인스턴스)로 이전하는 방법을 설명합니다.

## 호스팅 상태

어떤 네트워크 서비스에서든 알려진 계정은 특정 시점에 `active` 상태이거나 그렇지 않은 것으로 판단됩니다(불리언 값). 계정이 활성 상태가 아니라면, 해당 서비스는 그 계정의 콘텐츠(레포지토리, 개별 레코드, 블롭 등)를 재배포해서는 안 됩니다. 계정이 알려지지 않은 경우(이전에 본 적이 없는 경우), 상태는 정의되지 않을 수 있습니다.

정체성 메타데이터(DID 문서 및 핸들 상태)와 계정 호스팅 상태 자체는 호스팅된 콘텐츠와는 구분되며, 재배포될 수 있습니다.

네트워크 서비스는 계정의 현재 호스팅 상태를 설명하는 API 엔드포인트(예: `com.atproto.sync.getRepoStatus`)를 구현하는 것이 권장됩니다. 만약 이벤트 스트림을 노출한다면, 계정의 로컬 호스팅 상태가 업데이트될 때 `#account` 이벤트를 발행해야 합니다.

boolean `active` 외에도, 계정은 보다 구체적인 상태를 가질 수 있으며(모두 `active=false`에 해당):

- `deleted`: 사용자나 호스트가 계정을 삭제하여, 콘텐츠가 네트워크에서 제거되어야 함을 의미합니다. 영구적이거나 장기적인 의미를 내포하지만, 복구될 수 있습니다(삭제된 계정은 동일하거나 다른 호스트에서 재활성화될 수 있음).
- `deactivated`: 사용자가 전체 계정을 일시 중지한 상태입니다. 콘텐츠는 표시되거나 재배포되어서는 안 되지만, 인프라에서 삭제할 필요는 없습니다. 이는 시간 제한적임을 내포하며, 계정이 다른 PDS 인스턴스로 이전된 후의 초기 상태이기도 합니다.
- `takendown`: 호스트나 서비스가 계정을 중단시킨 상태입니다. 영구적이거나 장기적인 의미를 내포하지만, 복구될 수 있습니다.
- `suspended`: 호스트나 서비스가 계정을 일시 중지한 상태입니다. 이는 시간 제한적임을 내포합니다.

앞으로 새로운 계정 상태가 추가될 예정입니다. 예기치 않은 문제를 방지하기 위해, 관련 API 엔드포인트(예: `com.atproto.sync.getRepoStatus` 및 `com.atproto.sync.subscribeRepos` 이벤트 스트림의 `#account` 이벤트)는 불리언 `active`와 별도로 비활성 계정을 `status` 문자열로 명확히 구분합니다. 서비스는 계정의 전체 가시성을 제어하기 위해 `active` 플래그를 사용하고, `status` 문자열은 더 구체적인 인프라 동작(예: 데이터 삭제 등)을 결정하는 보조 정보로 활용해야 합니다.

비활성 상태인 deactivation과 suspension은 일시적임을 내포하지만, 무기한일 수 있습니다. 삭제(deletion)와 중단(takendown)은 보다 확정적인 의미를 내포하지만, 기술적으로는 복구될 수 있으며 실제로도 자주 복구됩니다.

하위 서비스는 중단(takendown)의 경우 콘텐츠를 빠르게 삭제할 수도 있고(삭제와 유사하게), 일정 기간 동안 단순히 재배포를 중단할 수도 있습니다.

정체성이 `tombstoned` 상태인 경우도 있는데, 이는 영구적이고 확정적인 의미를 내포하지만 특정 조건에서는 기술적으로 복구될 수 있습니다. 계정의 정체성이 `tombstoned`인 경우, 계정 호스팅 상태는 `deleted`로 해석되어야 합니다.

요약하면, 계정 상태가 `active`가 아닌 경우, 호스팅 서비스가 재배포해서는 안 되는 콘텐츠는 다음과 같습니다:

- 레포지토리 내보내기(CAR 파일)
- 레포지토리 레코드
- 변환된 레코드("뷰", 임베드 등)
- 블롭
- 변환된 블롭(썸네일 등)

### 호스팅 상태 전파

다른 atproto 요소와 달리, 계정 상태는 자체적으로 인증되지 않으며, 임의의 당사자 간에 인증된 전송이나 재배포 방법이 존재하지 않습니다.

대부분의 경우, 계정 상태는 “hop by hop” 방식으로 전파됩니다. 각 “하위” 서비스는 상위 서비스로부터 전달받은 계정의 호스팅 상태를 수용하고 채택합니다. 만약 중간 서비스(예: 릴레이)가 상위 서비스의 상태를 재정의한다면(예: 인프라에 의한 계정 중단), 해당 변경 사항은 하위 구독자에게 방송 및 전파되어야 합니다.

기본적으로, 계정의 현재 활성 PDS가 사용 불가능한 경우, 계정 상태는 적어도 일정 기간 동안은 변경되지 않아야 합니다. 이는 일시적인 인프라 장애 동안에도 네트워크의 탄력성을 유지하고 계정을 온라인 상태로 보존하기 위함입니다. 각 서비스는 장기간 동안 PDS 호스트가 오프라인인 계정에 대해 자체 정책을 결정할 수 있습니다.

일반적으로, 하위 서비스는 상위 서비스에서 비활성 상태로 보고된 계정을 `active`로 표시해서는 안 됩니다. 하지만 “상위”의 개념은 비공식적이므로, 일부 모서리 케이스에 대해서는 각 서비스가 자체 정책을 정의할 필요가 있습니다. 예를 들어, AppView가 서로 다른 정책을 가진 여러 독립적인 릴레이 공급자로부터 동일 계정에 대해 상이한 상태를 수신하거나, 릴레이와 PDS 간의 네트워크 연결에 문제가 있을 경우가 해당됩니다.

계정의 전반적인 상태에 대해 의문이 있는 경우, 해당 계정의 현재 활성 PDS 호스트에 `com.atproto.sync.getRepoStatus` 엔드포인트를 통해 조회할 수 있습니다. 만약 그곳에서 계정이 `active`가 아니라면, 특히 사용자가 직접 수행한 행동(비활성화 또는 삭제)의 경우, 다른 곳에서도 일반적으로 활성 상태로 간주되어서는 안 됩니다.

### 콘텐츠 삭제

전체 계정 상태와 별개로, 개별 콘텐츠가 제거될 수 있습니다. 계정이 공개 레포지토리에서 레코드를 삭제하는 경우, 호스팅 서비스는 해당 콘텐츠에 대한 공개 접근을 제거해야 합니다.

명시적인 “tombstones”(이전에 콘텐츠가 존재했음을 나타내는 표시)를 통해 이점을 얻고자 하는 애플리케이션은 Lexicon 스키마에 이를 명시적으로 설계해야 합니다. 명시적인 애플리케이션 수준의 tombstone이 없는 경우, 서비스는 존재하지 않았던 콘텐츠와 완전히 삭제된 콘텐츠를 구분하지 않아야 합니다. 이는 계정 수준의 삭제를 인정하는 것과는 다릅니다(계정 수준 삭제는 권장됨).

## PDS 계정 이전

높은 수준에서, 계정의 현재 PDS 호스트는 계정의 DID 문서에 표시됩니다. 만약 DID 문서가 새로운 PDS 호스트를 가리키도록 업데이트되고, 해당 호스트에서 계정 상태가 `active`이며(예를 들어, `deactivated`일 수 있음) 유효한 서명 및 커밋 `rev`를 가진 레포지토리가 존재한다면, 계정은 효과적으로 이전된 것으로 간주됩니다.

프로토콜 수준에서는 이것이 계정 이전이 작동하는 방식입니다. 또한, 이전 PDS 인스턴스가 사용 불가능하거나 계정 상태가 비활성인 경우, 위의 조건을 충족하는 것이 유일한 계정 복구 경로가 될 수 있습니다.

그러나 일반적인 경우, 기능하는 현재 PDS에서 활성 계정이 존재한다면 보다 원활한 계정 이전 프로세스가 가능합니다. 이는 몇 가지 높은 수준의 단계로 요약할 수 있습니다:

- 새로운 PDS에서 계정 생성(초기 상태는 `active`가 false일 수 있으며, 예를 들어 `deactivated` 상태)
- 이전 PDS에서 새로운 PDS로 데이터 이전
- 정체성(DID 문서) 업데이트: 새로운 PDS를 가리키고 새로운 atproto 서명 키 사용. PLC DID의 경우, 일반적으로 PLC 회전 키도 업데이트합니다.
- 두 PDS 인스턴스에서 계정 상태 업데이트: 이전 계정은 비활성, 새로운 계정은 활성으로 설정
- 새로운 atproto 서명 키로 서명되고 더 높은 커밋 `rev`를 포함하는 `#commit` 이벤트를 새로운 PDS에서 발행

## 사용 및 구현 가이드라인

가능한 계정 이전 흐름 중 하나는 [별도의 가이드](/guides/account-migration)에 자세히 설명되어 있습니다. 구체적으로 설명된 메커니즘은 프로토콜의 공식 부분은 아니며, 계정 이전의 유일한 방법은 아닙니다.

서로 다른 계정 이벤트 동안의 firehose 이벤트 순서에 대한 모범 사례는 [계정 수명 주기 베스트 프랙티스 가이드](/guides/account-lifecycle)에 설명되어 있습니다.

## 보안 고려사항

계정 호스팅 상태는 인증되지 않으며, 각 개별 네트워크 서비스에 따라 달라집니다. 계정의 현재 활성 PDS 호스트는 전체 계정 상태를 조회하기 위한 좋은 기본값이지만, 이는 넓은 네트워크 합의를 대표하지 않을 수 있으며(예: 중간 계정 중단), PDS 호스트가 계정 활성 상태를 잘못 표현할 가능성도 존재합니다.

하위 서비스가 계정 상태 변경을 처리하는 데 많은 리소스가 소요될 수 있습니다. 잘못된 행위자로 인한 리소스 고갈 공격을 방지하기 위해, 계정(DID) 수준 및 상위 서비스 제공자(PDS) 수준에서의 속도 제한(rate-limit)이 권장됩니다. 이러한 상황에서는 관련 계정을 비활성 상태(예: `suspended`)로 전환하여 계정이 “계속 활성 상태로 잠기지 않도록” 하는 것이 적절할 수 있습니다.

정체성(DID 및 핸들)의 관리는 atproto 권한 모델에서 매우 중요합니다. 사용자는 자신의 정체성 관리를 해당 호스트에 위임할 때(예: `did:plc` 사용 시), PDS 호스트를 신중하게 선택하고 평가해야 합니다.

## 향후 작업

호스팅 제공자 간의 계정 이전은 atproto의 핵심 설계 목표 중 하나이며, 새로운 프로토콜 기능이 계정 이전을 지원할 것으로 예상됩니다.

계정 이전 프로세스 자체도 개선되고 단순화될 수 있습니다.
